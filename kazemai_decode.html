<!doctype html>
<html>
    <head>
        <title>LZ Decode</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
        
        <script>
        function convert_formated_hex_to_bytes(hex_str) {
  var count = 0,
      hex_arr,
      hex_data = [],
      hex_len,
      i;
  
  if (hex_str.trim() == "") return [];
  
  /// Check for invalid hex characters.
  if (/[^0-9a-fA-F\s]/.test(hex_str)) {
    return false;
  }
  
  hex_arr = hex_str.split(/([0-9a-fA-F][0-9a-fA-F])/g);
  hex_len = hex_arr.length;
  
  for (i = 0; i < hex_len; ++i) {
    if (hex_arr[i].trim() == "") {
      continue;
    }
    hex_data[count++] = parseInt(hex_arr[i], 16);
  }
  return hex_data;
}

function convert_formated_hex_to_string(s) {
  var byte_arr = convert_formated_hex_to_bytes(s);
  var res = "";
  for (var i = 0 ; i<byte_arr.length ; i+=2) {
    res += String.fromCharCode(byte_arr[i] | (byte_arr[i+1]<<8));
  }
  return res;
}
</script>

<!-- <script type="text/javascript" src="./master.js"></script> -->
<script>
    let master, raw, data;
    function saveMasterJSON(indent) {
        
        fetch('https://raw.githubusercontent.com/KazeMai/fgo-vz/gh-pages/common/js/master.js')
        .then(r => r.text())
        .then(t => t.split("\'")[1])
        .then(text => {
            raw = text;
            master = LZString.decompress(convert_formated_hex_to_string(raw));
            data = JSON.parse(master);
            
            if (indent > 0) {
                master = JSON.stringify(data, null, indent);
            }

            let f = new Blob([master], {type: "application/json"});
            console.log("saving");
            saveAs(f, "fgo_master.json");
            console.log("done");
            
            
        });
        // console.log(mstTxt);
    }
        
    </script>
    </head>
    <body>
        <p>Parsing from https://raw.githubusercontent.com/KazeMai/fgo-vz/gh-pages/common/js/master.js
            </p>
        <button onclick="javascript:saveMasterJSON(2)">Save with indent</button> <br>
        <button onclick="javascript:saveMasterJSON(0)">Save without indent</button>

        </body>
</html>